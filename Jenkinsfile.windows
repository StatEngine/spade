#!/usr/bin/groovy

node('windows') {
  def root = pwd()

  stage('Setup') {
    git url: 'https://github.com/StatEngine/spade', branch: 'master'
  }

  stage('Archive') {
    withEnv(["ARTIFACT_BUCKET=\$ARTIFACT_BUCKET"]) {
    bat """
      npm install
      npm make

      if not exist "artifacts" mkdir artifacts
      del /s /q "artifacts\\*"

      7zip a artifacts\\spade.zip * -xr artifacts

      set ARTIFACT=artifacts\\spade.zip

      call bin\\s3Push.bat
    """
    }
  }
}
